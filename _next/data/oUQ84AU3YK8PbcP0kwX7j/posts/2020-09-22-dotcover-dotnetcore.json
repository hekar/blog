{"pageProps":{"post":{"title":"Dotcover in Dotnet Core","date":"2020-09-22","slug":"2020-09-22-dotcover-dotnetcore","content":"<p>Code coverage can be a useful heuristic for determining whether code is adequately executed by a given set of unit tests.</p>\n<p>Tooling that produces code coverage will never be able to inform you how well your assertions specified, but they will give adequate information an about whether a portion of code is executed.</p>\n<p>There are numerous code coverage tools available for C#. One of them by Jetbrains and is called Dotcover.</p>\n<hr>\n<p><a href=\"https://www.jetbrains.com/dotcover/\">Dotcover</a> works with <a href=\"https://dotnet.microsoft.com/download/dotnet-core\">Dotnet Core</a> applications out of the box. Configuration can be slightly difficult if using with Sonarqube, but this guide details how to change the coverage report format.</p>\n<p><a href=\"https://www.jetbrains.com/dotcover/\">Dotcover</a> integrates with <a href=\"https://docs.microsoft.com/en-us/dotnet/core/testing/unit-testing-with-mstest\">MSTest</a>, <a href=\"https://nunit.org/\">NUnit</a>, <a href=\"https://xunit.net/\">xUnit</a>, and <a href=\"https://github.com/machine/machine.specifications\">MSpec</a>. It can be executed through the <a href=\"https://www.jetbrains.com/help/dotcover/Running_Coverage_Analysis_from_the_Command_LIne.html\">command-line</a> or <a href=\"https://visualstudio.microsoft.com/\">Visual Studio</a>.</p>\n<p>Jetbrains unfortunately requires licensing for the applications. It is a proprietary tool requiring payment for closed-source projects. Students have free access and there are discounts in other circumstances. See the <a href=\"https://www.jetbrains.com/dotcover/buy/#discounts\">Pricing</a> page for more information. One common alternative is <a href=\"https://github.com/coverlet-coverage/coverlet\">coverlet</a> which uses the preferable open-source MIT license.</p>\n<h2>Create Project</h2>\n<p>If you do not have an existing project you can create one using templates provided for dotnet core, such as the ConsoleApp template.</p>\n<p>The commands below: create ConsoleApp, ConsoleApp.Tests and ConsoleApp solution. After the steps below have been run, the test project will reference the ConsoleApp project, while the solution will reference both. The solution file can be opened in Visual Studio or another C# IDE.</p>\n<pre><code class=\"hljs language-sh\"><span class=\"hljs-built_in\">mkdir</span> project\n<span class=\"hljs-built_in\">cd</span> project\ndotnet new console --name ConsoleApp\ndotnet new xunit --name ConsoleApp.Tests\n<span class=\"hljs-built_in\">cd</span> ConsoleApp.Tests\ndotnet add reference ../ConsoleApp/ConsoleApp.csproj\n<span class=\"hljs-built_in\">cd</span> ..\ndotnet new sln --name ConsoleApp\ndotnet sln add ConsoleApp ConsoleApp.Tests\n</code></pre>\n<h2>Add Dotcover</h2>\n<p>To include Dotcover in the unit test project, open <code>./ConsoleApp.Tests/ConsoleApp.Tests.csproj</code> in a text editor. Add the following:</p>\n<pre><code class=\"hljs language-xml\">  <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ItemGroup</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">DotNetCliToolReference</span> <span class=\"hljs-attr\">Include</span>=<span class=\"hljs-string\">\"JetBrains.dotCover.DotNetCliTool\"</span> <span class=\"hljs-attr\">Version</span>=<span class=\"hljs-string\">\"2020.2.3\"</span> /></span>\n  <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ItemGroup</span>></span>\n</code></pre>\n<p>Afterwards run the following command to install the required dependencies:</p>\n<pre><code class=\"hljs language-sh\">dotnet restore\n</code></pre>\n<h2>Run dotcover</h2>\n<p>By default dotcover configuration outputs a <code>.dcvr</code> file.</p>\n<pre><code class=\"hljs language-sh\">dotnet dotcover <span class=\"hljs-built_in\">test</span>\n</code></pre>\n<h2>Additional configuration</h2>\n<p>This step is entirely optional, but you can create a file for dotcover configuration. The example below exports coverage information useful for sonarscanner. This makes it easy to run Sonarqube scans against your applications.</p>\n<pre><code class=\"hljs language-sh\">dotnet dotcover <span class=\"hljs-built_in\">test</span> --dotCoverXml=dotcover.xml\n</code></pre>\n<p>dotcover.xml</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">AnalyzeParams</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">Output</span>></span>dotCover.html<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">Output</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ReportType</span>></span>html<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ReportType</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">AttributeFilters</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">AttributeFilterEntry</span>></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ClassMask</span>></span>System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverageAttribute<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ClassMask</span>></span>\n        <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">AttributeFilterEntry</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">AttributeFilters</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">Scope</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ScopeEntry</span>></span>../ConsoleApp/**/*.dll<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ScopeEntry</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ScopeEntry</span>></span>../ConsoleApp/**/*.exe<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ScopeEntry</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">Scope</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">Filters</span>></span>\n        <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ExcludeFilters</span>></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">FilterEntry</span>></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ModuleMask</span>></span>ConsoleApp.Tests<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ModuleMask</span>></span>\n            <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">FilterEntry</span>></span>\n            <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">FilterEntry</span>></span>\n                <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">ModuleMask</span>></span>xunit.assert<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ModuleMask</span>></span>\n            <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">FilterEntry</span>></span>\n        <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">ExcludeFilters</span>></span>\n    <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">Filters</span>></span>\n<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">AnalyzeParams</span>></span>\n</code></pre>\n<p>Open <code>ConsoleApp.Tests/dotcover.html</code> to see the final coverage report in your web browser.</p>\n<p><img src=\"https://i.imgur.com/v8l1RKb.png\" alt=\"example-coverage-report\"></p>\n<h2>Conclusion</h2>\n<p>Dotcover is easy to setup and configure with Dotnet Core projects. The only issue is the license modeling does not work well for many types of projects. Particularly closed-source applications. Further when integrating Dotcover into your professional work environment there is the added overhead of license configuration and maintenance. Configuration can be difficult, but once configured it is straightforward to use in CI/CD environments with little operations overhead. Overall Dotcover is a high quality tool that can be useful in certain circumstances where open-source tooling such as coverlet cannot be used.</p>\n<p>For an example of a project using dotcover, see <a href=\"https://github.com/hekar/joke-generator\">hekar/joke-generator</a> on Github.</p>"}},"__N_SSG":true}